###
# This file is part of a project hosted at https://github.com/stellaris-mods
# Copyright (c) 2017 folk@folk.wtf
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software Foundation,
# Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
###

namespace = assInit

# on_game_start
event = {
	id = assInit.1
	is_triggered_only = yes
	hide_window = yes
	immediate = {
		set_global_flag = "has_auto_assembler"
	}
}

# invoked from mod menu
country_event = {
	id = assInit.10
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		if = { limit = { has_country_flag = "ass_free_tech" }
			every_country = {
				limit = {
					OR = {
						is_ai = no
						is_country_type = "default"
					}
					# Only players or default AI empires get the tech.
					# Prevents primitives and such from getting it.
				}
				give_technology = {
					tech = tech_autonomous_assembler
					message = yes
				}
			}
		}
	}
}

# on_tech_increased
country_event = {
	id = assInit.100
	is_triggered_only = yes
	hide_window = yes
	trigger = {
		has_global_flag = "ass_free_ship"
		last_increased_tech = "tech_autonomous_assembler"
	}
	# ZZZ Delay by one day to allow the auto-design to appear
	immediate = { country_event = { id = assInit.101 days = 1 } }
}
country_event = {
	id = assInit.101
	hide_window = yes
	is_triggered_only = yes
	immediate = {
		create_fleet = {
			effect = {
				set_owner = PREV
				create_ship = {
					name = random
					random_existing_design = autonomous_assembler
				}
				set_fleet_stance = evasive
				set_location = PREV.capital_scope
			}
		}
		# Delay this, too, so that count_owned_ships picks it up
		country_event = { id = assCountry.500 days = 1 }
		# We could try to initiate an operation immediately, but it always fails
		# because nothing is surveyed etc.
		# MTTH event triggers after a few days anyway.
	}
}
